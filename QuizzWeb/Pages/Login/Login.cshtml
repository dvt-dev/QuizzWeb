@page
@model QuizzWeb.Pages.Login.LoginModel
@{
    Layout = "";
}

<link href="/css/site.css" rel="stylesheet" />
    <style>

        #login {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
      
        .login-container {
            width: 500px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: #ddd;
        }

        .login-title{
            font-size: 6rem;
            text-align: center;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form_item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        input {
            outline: none;
            transition: ease-in-out .3s;
            position: relative;
            height: 40px;
            padding: 0 10px;
            font-size: 1.8rem;
            border: 1px solid #9f9f9f;
            font-family: "Plus Jakarta Sans", sans-serif;
        }

        .forgot-password {
            cursor: pointer;
        }

        .login-btn {
            background-color: #fff;
            padding: 12px 16px;
            width: fit-content;
            margin: 0 auto;
            box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        }

            .login-btn:hover {
                cursor: pointer;
                background-color: #5a3ac9;
                color: white;
                transition: all .3s ease-in;
            }

    .control {
        text-align:center;
    }

    .control a {
        cursor: pointer;
    }

   /* @@media screen and (max-width: 767px) {
        .login-container {
            width: 800px;
        }

        .login-form_label {
            font-size: 2.4rem;
        }

        input {
            height: 60px;
            font-size: 2.4rem;
        }
        
    }*/
    </style>


<div id="login">
    <div class="login-container">
        <h1 class="login-title">Login</h1>
        <form class="login-form">
            <div class="login-form_item">
                <label class="login-form_label">Tên đăng nhập</label>
                <input id="account" class="login-form_input" autocomplete="username" type="text" placeholder="Nhập tên đăng nhập" />
            </div>
            <div class="login-form_item">
                <label class="login-form_label">Mật khẩu</label>
                <input id="password" class="login-form_input" type="password" autocomplete="current-password" placeholder="Nhập mật khẩu" />
            </div>
        </form>
        <button class="login-btn" onclick="login()">Đăng nhập</button>
        <div class="control">
            <span>Don't have an account yet?</span>
            <a>Register now</a>
        </div>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    $("a").click(function() {
        window.location.href = '/register/register';
    })

    const setCookie = (cname, cvalue, exdays = 7) => {
        //let userToken = rs.data;
        //let expires = new Date();
        //expires.setTime(expires.getTime() + (7 * 24 * 60 * 60 * 1000));
        //let cookieString = "userToken=" + userToken + "; expires=" + expires.toUTCString() + "; path=/";
        //document.cookie = cookieString;

        const date = new Date();
        date.setTime(date.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + date.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    const login = async () => {
        let model = {
            account: $('#account').val(),
            password: $('#password').val(),
        }

        let rq = await fetch('https://localhost:7270/api/User/Login', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json; charset=utf-8'
            },
            body: JSON.stringify(model)
        })

        let rs = await rq.json();

        const userToken = rs.data;
        
        if(userToken === null || userToken === "" || typeof userToken === undefined) {
            alert("Tài khoản chưa được đăng ký !");
            return;
        } else {
            setCookie("userToken", userToken);
            setTimeout(() => {
                window.location.href = ("/");
            }, 0)
        }

        //window.location.href = ("/");
    }

   
</script>
